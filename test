<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automation Activity Folder Path Lookup</title>
</head>
<body>
    <h1>Automation Activity Folder Path Lookup</h1>
    <form method="get">
        <label for="activityName">Enter Activity Name:</label>
        <input type="text" id="activityName" name="activityName" required>
        <input type="submit" value="Lookup">
    </form>

    <h2>Folder Path: <span id="folderPath"></span></h2>

    <script runat="server">
        Platform.Load("Core", "1");
        var api = new Script.Util.WSProxy();

        function getFolderPath(categoryId) {
            var path = '';
            var folder = api.retrieve("DataFolder", ["ID", "Name", "ParentFolder.ID"], { Property: "ID", SimpleOperator: "equals", Value: categoryId });
            if (folder && folder.Results && folder.Results.length > 0) {
                var currentFolder = folder.Results[0];
                while (currentFolder) {
                    path = currentFolder.Name + '/' + path;
                    if (currentFolder.ParentFolder && currentFolder.ParentFolder.ID) {
                        currentFolder = api.retrieve("DataFolder", ["ID", "Name", "ParentFolder.ID"], { Property: "ID", SimpleOperator: "equals", Value: currentFolder.ParentFolder.ID }).Results[0];
                    } else {
                        currentFolder = null;
                    }
                }
            }
            return path;
        }

        try {
            var activityName = Request.GetQueryStringParameter("activityName");
            if (activityName) {
                var filter = { Property: "Name", SimpleOperator: "equals", Value: activityName };
                var activities = api.retrieve("AutomationActivity", ["Name", "CategoryID"], filter);
                if (activities && activities.Results && activities.Results.length > 0) {
                    var categoryId = activities.Results[0].CategoryID;
                    var folderPath = getFolderPath(categoryId);
                    Variable.SetValue("@folderPath", folderPath);
                } else {
                    Variable.SetValue("@folderPath", "Activity not found");
                }
            }
        } catch (err) {
            Variable.SetValue("@folderPath", "Error: " + String(err));
        }
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var folderPath = "<!--=v(@folderPath)=-->";
            document.getElementById("folderPath").innerText = folderPath;
        });
    </script>
</body>
</html>
